<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Adinor PA Vidrio montado</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Roboto&display=swap" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Montserrat', sans-serif;
    }

    .formulario {
      display: none;
    }
    .formulario.active {
      display: block;
    }

    h2 {
      font-size: 30px;
      color: #1a2b6f;
      margin-bottom: 30px;
    }

    form {
      margin-left: 30px;
    }

    .btn {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
      min-width: 120px;
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .botones-formulario {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }


    
    #form1 .opciones-imagenes, #form2 .opciones-imagenes, #form4 .opciones-imagenes, #form5 .opciones-imagenes {
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    #form1 .opcion, #form2 .opcion, #form4 .opcion, #form5 .opcion {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #form1 .opcion img {
      width: 230px;
      height: 240px;
      object-fit: contain;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #form2 .opcion img {
      width: 270px;
      height: 200px;
      object-fit: cover;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #form4 .opcion img {
      width: 200px;
      height: 180px;
      object-fit: contain;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #form5 .opcion img {
      width: 110px;
      height: 220px;
      object-fit: contain;  /* Contein se ajusta a cuadro que tengamos es un zoom mas ajustado */
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #form1 .selector, #form2 .selector {
      margin-top: 20px;
    }

    #form1 .opcion input[type="radio"], #form2 .opcion input[type="radio"], #form3 .opcion input[type="radio"], #form4 .opcion input[type="radio"]{
      margin-top: 10px;
    }

    #form3 p {
      font-weight: bold;
      margin-top: 15px;
      margin-bottom: 5px;
    }

    #form3 label {
      display: block;
      margin-left: 40px;
      margin-bottom: 5px;
      line-height: 1.2;
    }

    #form6 label {
      margin-left: 5px;
      display: block;
    }

    #form6 select,
    #form6 input[type="number"] {
      width: 100%;
      box-sizing: border-box;
      padding: 5px;
    }

    #form6 .columna {
      width: 200px;
    }

    /* ================================== */
    /* ESTILOS DEL INFORME */
    /* ================================== */


    #informe-container {
      display: none;
      max-width: 900px;
      margin: 20px auto;
      padding: 40px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }


    .informe-header {
        border-bottom: none;
        padding-bottom: 5px;
        margin-bottom: 10px;  /* M√°s espacio antes de "MEDIDAS DE PUERTA" */
    }


    .informe-header h1 {   /* el titulo del informe*/ 
      font-size: 24px;
      margin-bottom: 10px;
      color: #2a2a2a;
    }

    /* Campos de cabecera en l√≠nea horizontal */
    .info-basica {
      display: grid;
      grid-template-columns: 1fr 150px 150px;
      gap: 15px;
      margin-bottom: 10px;
    }

    .campo-informe {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0; /* permite que los campos se reduzcan si es necesario */
    }

    .campo-informe label {
      font-weight: bold;
      font-size: 12px;
      white-space: nowrap;
      flex-shrink: 0; /* evita que el label se achique demasiado */
      color: #555;
    }

    .campo-informe input {     /*   Las casillas de cabecera*/
      flex: 1 1 auto; /* permite que el input crezca y se reduzca */
      padding: 6px;           /* Altura de casilla*/
      border: 1px solid #333;
      border-radius: 3px;
      font-size: 12px;
      min-width: 0; /* evita que imponga un ancho m√≠nimo */
    }

  
    /* Estilos para bloques */
    .bloque-informe {
      display: none;
      margin-top: 20px;
    }

    .bloque-informe.active {
      display: block;
    }

    .bloque-titulo {
      background: #bbb;
      border: 2px solid #999;  /* Borde gris que S√ç se imprime */
      padding: 6px 20px;     
      font-weight: bold;
      font-size: 12px;
      margin: 10px 0;    /* - A√±ade espacio externo; arriba y abajo, 0 a los lados */
      border-radius: 4px;

    }

    .seccion-titulo {
      font-weight: bold;
      font-size: 12px;
      margin: 15px 0 8px 0;
      color: #333;
    }

    /* ----------------------------------  Definiciones de la tabla dentro de informe 1  --------------------------------*/

    .tabla-informe {
    width: calc(100% - 200px);   /* Calcula el ancho de la tabla como el 100% del contenedor menos 50 p√≠xeles.*/
    border-collapse: collapse;   /*  Hace que las celdas de la tabla compartan los bordes comunes.*/
    margin: 5px 10px 0px 100px; /*Define los m√°rgenes externos de la tabla, arriba, derecha, abaj, izquierda */
    }

      .tabla-informe th,
      .tabla-informe td {
        border: 1px solid #333;
        padding: 6px 8px;   /*  espacio interno de la celda arriba y abajo / a los lados  */ 
        text-align: center;
        font-size: 12px;
        line-height: 0.8;    /* 80% de la Altura de la letra */ 
      }

      .tabla-informe th {
        background: #ddd;
        font-weight: bold;

      }

    .tabla-informe td:empty {
      border: none; 
      padding: 0; 
      background: transparent;
    }



    .tabla-informe .imagen-perfil {
      width: 80px;
      font-size: 20px;
    }

    .tabla-informe .texto-izq {
      text-align: left;
      padding-left: 15px;
    }
     .tabla-informe .texto-Der {
      text-align: Right;
      padding-right: 18px;
    }
    /* Botones del informe */

    .botones-informe {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid #eee;
    }


    /*---------------   Impresion del form  */
    /* Configuraciones para que imprima igual que se ve en pantalla */ 
    @media print {
    body {
      background: white !important;
      color: black !important;
    }

    .btn, nav, footer {
      display: none; /* Oculta elementos innecesarios */
    }

    input {
      border: none !important;
      background: none !important;
      color: black !important;
    }

    #informe-container {
      display: block !important;
      box-shadow: none!important;
      margin: 0 !important ;
      padding: 0 !important;
    }

    .bloque-informe {
      display: block !important;
    }



    .modo-impresion {
        background: white !important;
        color: black !important;
    }

    /* --------------------------------------*/
    /*  ------- Css  Segundo informe         */
    /*  -------------------------------------*/

    #hoja-pedido-container {
        width: 210mm;              /* ancho A4 */
        margin: 0 auto;
        padding: 15mm;             /* m√°rgenes A4 */
        box-sizing: border-box;
    }

    #hoja-pedido-container .tabla-informe {
        width: 100%;               /* igual que cabecera */
        margin: 10px 0 0 0;
    }

    #hoja-pedido-container .tabla-informe td {
        text-align: left !important;   /* Valor alineado a la izquierda */
        padding-left: 15px;
    }

    #hoja-pedido-container .tabla-informe th {
        text-align: left;
        padding-left: 15px;
    }

/* Quita m√°rgenes extra al imprimir */
    @media print {
    #hoja-pedido-container {
        box-shadow: none;
        padding: 0;
        margin: 0;
        width: 100%;
    }
    }
    
    .span-dato {
        border: 1px solid #333;
        border-radius: 3px;
        padding: 6px 8px;
        font-size: 12px;
        display: inline-block;
        min-width: 120px;
        background: #f9f9f9;
    }

          /* ==========  ESTILOS EXCLUSIVOS PARA PDF (html2pdf)  ========== */
          
      #pdf-wrapper {
        background: white;
        color: black;
        font-family: 'Roboto', sans-serif;
        font-size: 12px;
        line-height: 1.2;
        width: 210mm;          /* A4 */
        box-sizing: border-box;
        padding: 15mm;
      }

      #pdf-wrapper .informe-header,
      #pdf-wrapper .bloque-informe,
      #pdf-wrapper .tabla-informe {
        display: block !important;   /* fuerza visibilidad */
      }

      #pdf-wrapper .botones-informe,
      #pdf-wrapper .btn {
        display: none !important;    /* no imprime botones */
      }

      /* Salto de p√°gina manual despu√©s del informe 1 */
      #pdf-wrapper .salto-pagina {
        page-break-after: always;
        height: 0;
        visibility: hidden;
      }

      #pdf-wrapper {
        width: 210mm;
        background: white;
        color: black;
        font-family: 'Roboto', sans-serif;
        padding: 15mm;
        box-sizing: border-box;
      }

    }


  </style>

</head>
<body>

  <!-- Formulario 1 -->
  <form id="form1" class="formulario active">
    <h2>Configurador Sistema PA montado con vidrio</h2>
        <div class="opciones-imagenes">
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/PuertaCorredera.png" alt="Opci√≥n 1" width="300"><br><br>
        <p>Puerta corredera</p>
        <input type="radio" name="imagen" value="1">
      </label>
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/PuertaAbatible.png" alt="Opci√≥n 2" width="300"><br><br>
        <p>Puerta Abatible</p>
        <input type="radio" name="imagen" value="2">
      </label>

    </div>
    <br>
    <p>Seleccionar una opci√≥n antes de continuar</p>
    <br>
    <div class="botones-formulario">
        <button type="button" onclick="siguienteFormulario(1)" class="btn">Siguiente</button>
    </div>
  </form>

  <!-- Formulario 2 -->
  <form id="form2" class="formulario">
    <h2>Gu√≠as Sky</h2>
    <div class="opciones-imagenes">
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/SK112.png" alt="Opci√≥n 1" width="150"><br><br>
        <p>Montaje a pared</p>
        <input type="radio" name="guia" value="SK112">
      </label>
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/SK111.png" alt="Opci√≥n 2" width="150"><br><br>
        <p>Montaje a techo</p>
        <input type="radio" name="guia" value="SK111">
      </label>
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/SK119.png" alt="Opci√≥n 3" width="150"><br><br>
        <p>Montaje gu√≠a empotrada</p>
        <input type="radio" name="guia" value="SK119">
      </label>
    </div>
    <br>
    <p>Seleccionar una opci√≥n antes de continuar</p>
    <br>
    <div class="botones-formulario"> 
      <button type="button" onclick="anteriorFormulario(2)" class="btn">Atr√°s</button>
      <button type="button" onclick="siguienteFormulario(2)" class="btn">Siguiente</button>
    </div>
  </form>




  <!-- Formulario 3 -->
  <form id="form3" class="formulario">
    <h2>Combinaci√≥n de puertas 3</h2>
    <p>1 elementos</p>
    <label><input type="radio" name="opcion" value="1puerta"> 1 puerta</label>
    <label><input type="radio" name="opcion" value="1puerta-casoneto"> 1 puerta casoneto</label>
    <p>2 elementos</p>
    <label><input type="radio" name="opcion" value="2puertas"> 2 puertas</label>
    <label><input type="radio" name="opcion" value="1puerta-1fijo"> 1 puerta y 1 fijo</label>
    <p>3 elementos</p>
    <label><input type="radio" name="opcion" value="3puertas"> 3 puertas con arrastres</label>
    <label><input type="radio" name="opcion" value="2puertas-1fijo"> 2 puertas y 1 fijo</label>
    <label><input type="radio" name="opcion" value="1puerta-2fijos"> 1 puerta y 2 fijos</label>
    <p>4 elementos</p>
    <label><input type="radio" name="opcion" value="2puertas-2fijos"> 2 puertas 2 fijos</label>
    <label><input type="radio" name="opcion" value="3puertas-1fijo"> 3 puertas y 1 fijo</label>
    <label><input type="radio" name="opcion" value="4puertas"> 4 puertas con arrastres</label>
    <br>
    <p>Seleccionar una opci√≥n antes de continuar:</p>
    <div class="botones-formulario">
      <button type="button" onclick="anteriorFormulario(3)" class="btn">Atr√°s</button>
      <button type="button" onclick="siguienteFormulario(3)" class="btn">Siguiente</button>
    </div>
    </form>

  <!-- Formulario 4 -->
  <form id="form4" class="formulario">
    <h2>Tipolog√≠a de Fijo 4</h2>
    <div class="opciones-imagenes">
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/FijoPared3.png" alt="Opci√≥n 1" width="150"><br>
        <p>3 paredes</p>
        <input type="radio" name="imagen" value="0">
      </label>
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/FijoPared3U.png" alt="Opci√≥n 1" width="150"><br>
        <p>3 paredes U</p>
        <input type="radio" name="imagen" value="A">
      </label>
      <label class="opcion">
        <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/FijoPared4.png" alt="Opci√≥n 2" width="150"><br>
        <p>4 paredes</p>
        <input type="radio" name="imagen" value="B">
      </label>
    </div>
    <br>
    <p>Seleccionar una opci√≥n antes de continuar</p>
    <br>
    <div class="botones-formulario">
      <button type="button" onclick="anteriorFormulario(4)" class="btn">Atr√°s</button>
      <button type="button" onclick="siguienteFormulario(4)" class="btn">Siguiente</button>
    </div>
  </form>

  <!-- Formulario 5    DIVISIONES   -->
<form id="form5" class="formulario">
  <h2>Divisiones Adhesivas 13x3</h2>
  <div class="opciones-imagenes">
    <label class="opcion">
      <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/Divisiones_0.png" alt="Sin Img" width="150"><br>
      <p>Sin embellecedor</p>
      <input type="radio" name="NumDiv" value="0">
    </label>
    <label class="opcion">
      <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/Divisiones_1.png" alt="Sin Img" width="150"><br>
      <p>Modelo A</p>
      <input type="radio" name="NumDiv" value="2">
    </label>
    <label class="opcion">
      <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/Divisiones_2.png" alt="Sin Img" width="150"><br>
      <p>Modelo B</p>
      <input type="radio" name="NumDiv" value="4">
    </label>
    <label class="opcion">
      <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/Divisiones_3.png" alt="Sin Img" width="150"><br>
      <p>Modelo C</p>
      <input type="radio" name="NumDiv" value="6">
    </label>
    <label class="opcion">
      <img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/Divisiones_3_Plus.png" alt="Sin Img" width="150"><br>
      <p>Modelo D</p>
      <input type="radio" name="NumDiv" value="D">
    </label>
  </div>
  <br>
  <p>Seleccionar una opci√≥n antes de continuar</p>
  <br>
  <div class="botones-formulario">
    <button type="button" onclick="anteriorFormulario(5)" class="btn">Atr√°s</button>
    <button type="button" onclick="siguienteFormulario(5)" class="btn">Siguiente</button>
  </div>
</form>

  <!-- Formulario 6 -->
<!-- Formulario 6 -->
<form id="form6" class="formulario">
  <h2>Medidas de Instalaci√≥n</h2>
  
  <!-- Primera fila: Alto, Acabado y Color (3 columnas) -->
  <div style="display: flex; gap: 50px; justify-content: center; margin-bottom: 5px;">
    <div style="width: 200px;">
      <label for="Alto">Alto de hueco<br>
        <input type="number" id="Alto" name="Alto" required min="1" style="width: 100%; box-sizing: border-box; padding: 8px;">
      </label>
    </div>
    <div style="width: 200px;">
      <label for="AcabadoAluminio">Acabado Aluminio<br>
        <select id="AcabadoAluminio" name="AcabadoAluminio" required style="width: 100%; box-sizing: border-box; padding: 8px;">
          <option value="Blanco mate 9003">Blanco mate 9003</option>
          <option value="Negro mate texturado">Negro mate texturado</option>
          <option value="Acero corten">Acero corten</option>
          <option value="Chapa roble barnizada">Chapa roble barnizada</option>
          <option value="Chapa nogal barnizada">Chapa nogal barnizada</option>
        </select><br><br>
      </label>
    </div>
    <div style="width: 200px;">
      <label for="ColorVidrio">Color de vidrio<br>
        <select id="ColorVidrio" name="ColorVidrio" required style="width: 100%; box-sizing: border-box; padding: 8px;">
          <option value="TRANSPARENTE">Transparente</option>
          <option value="MATE">Mate</option>
          <option value="BRONCE">Bronce</option>
          <option value="GRIS">Gris</option>
          <option value="GRIS OSCURO">Gris oscuro</option>
        </select><br>
      </label>
    </div>
  </div>
  
  <!-- Segunda fila: Solo Ancho (1 columna a la izquierda) -->
  <div style="display: flex; gap: 50px; justify-content: center; margin-bottom: 20px; margin-top: 10px">
    <div style="width: 200px;">
      <label for="Ancho">Ancho de hueco<br>
        <input type="number" id="Ancho" name="Ancho" required min="1" style="width: 100%; box-sizing: border-box; padding: 8px;"><br><br>
      </label>
    </div>
    <div style="width: 200px;"></div> <!-- Espacio vac√≠o a la derecha -->
    <div style="width: 200px;"></div> <!-- Espacio vac√≠o a la derecha-->
  </div>
  <!-- Tercera fila: Cliente y N¬∫ Pedido -->
  <div style="display: flex; gap: 50px; justify-content: center; margin-bottom: 20px; margin-top: 30px;">    <!-- Margin-top es la distacia a la linea anterior    -->
    <label style="width: 450px;"> <!-- 200 + 50 + 200 = 450px para ocupar 2 columnas -->
      Cliente<br>
      <input type="text" name="cliente" required style="width: 100%; box-sizing: border-box; padding: 8px; height: 30px; font-size: 16px;">
    </label>
    <label style="width: 200px;">
      N¬∫ Pedido<br>
      <input type="text" name="numPedido" required style="width: 100%; box-sizing: border-box; padding: 8px; height: 30px; font-size: 16px;">
    </label>
  </div>
  
    <!-- Cuarta fila: Comentarios (l√≠nea completa) -->
    <div style="display: flex; justify-content: center;">
      <label style="width: 700px;"> <!-- 200√ó3 + 50√ó2 = 700px -->
        Comentarios<br>
        <textarea name="comentarios" rows="2" style="width: 100%; box-sizing: border-box; padding: 8px; font-size: 16px; resize: vertical; font-family: inherit;"></textarea>
      </label>
    </div>
    <br><br>
    <div style="display: flex; gap: 50px; justify-content: center; margin-bottom: 20px;">
  <label style="width: 200px;">
    N¬∫ de conjuntos a fabricar<br>
    <input type="number" name="conjuntos" required min="1" value="1" style="width: 100%; box-sizing: border-box; padding: 8px; font-size: 16px;">
  </label>
  <div style="width: 450px;"></div> <!-- espacio vac√≠o -->
</div>


    <div class="botones-formulario" style="margin-top: 40px;">
      <button type="button" onclick="anteriorFormulario(6)" class="btn">Atr√°s</button>
      <button type="button" onclick="siguienteFormulario(6)" class="btn">Siguiente</button>
    </div>

  </form>



  <!-- -->
  <!-- &&&&&&&&&&&&&&&&&&&&&     INFORME 1  &&&&&&&&&&&&&&&&&&&&&&& -->
  <!-- CONTENEDOR DEL INFORME -->
  <div id="informe-container">
    <div class="informe-header">
      <h1>PA VIDRIO MONTADO - HOJA DE FABRICACION</h1>
      <div class="info-basica">
        <div class="campo-informe">
          <label>Cliente</label>
          <span id="inf-cliente"></span>
        </div>
        <div class="campo-informe">
          <label>Num Pedido</label>
          <span id="inf-num-pedido"></span>
        </div>
        <div class="campo-informe">
          <label>Fecha</label>
          <span id="inf-fecha"></span>
        </div>
      </div>
      <div class="comentarios-informe">
        <div class="campo-informe">
          <label>Comentarios</label>
          <span id="inf-comentarios"></span>
        </div>
      </div>
    
      <!--  <p id="mensaje-opcion"></p>  -->
      <p id="mensaje-opcion" style="font-weight: bold; margin: 25px 0 0 0; font-size: 14px;"></p>
    </div>

    <!-- BLOQUE PUERTA -->
    <div id="bloque-puerta" class="bloque-informe">
      <div class="bloque-titulo">MEDIDAS DE PUERTA</div>
      
      <div class="seccion-titulo">Perfiles Acabado <span id="acabado-puerta"></span></div>
      <table class="tabla-informe">
        <thead>
          <tr>
            <th class="imagen-perfil"></th>
            <th>Tipo</th>
            <th>Longitud mm</th>
            <th>Cantidad</th>
            <th>Retrac Sup+Inf</th>
          </tr>
        </thead>
        <tbody id="tabla-perfiles-puerta">
        </tbody>
      </table>

      <table class="tabla-informe">
        <thead>
          <tr>
            <th>Embellecedor</th>
            <th>Longitud mm</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody id="tabla-embellecedor-puerta">
        </tbody>
      </table>

      <div class="seccion-titulo">Medidas de Cristales <span id="color-vidrio-puerta"></span></div> 
      <table class="tabla-informe">
        <thead>
          <tr>
            <th>Vidrio Acabado</th>
            <th>Alto mm</th>
            <th>Ancho mm</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody id="tabla-cristales-puerta">
        </tbody>
      </table>
    </div>

    <!-- BLOQUE FIJO -->
    <div id="bloque-fijo" class="bloque-informe">
      <div class="bloque-titulo">MEDIDAS DE FIJO</div>
      
      <div class="seccion-titulo">Perfiles Acabado <span id="acabado-fijo"></span></div>
      <table class="tabla-informe">
        <thead>
          <tr>
            <th class="imagen-perfil"></th>
            <th>Tipo</th>
            <th>Longitud mm</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody id="tabla-perfiles-fijo">
        </tbody>
      </table>

      <table class="tabla-informe">
        <thead>
          <tr>
            <th>Embellecedor</th>
            <th>Longitud mm</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody id="tabla-embellecedor-fijo">
        </tbody>
      </table>

      <div class="seccion-titulo">Medidas de Cristales <span id="color-vidrio-fijo"></span></div>
      <table class="tabla-informe">
        <thead>
          <tr>
            <th>Vidrio Acabado</th>
            <th>Alto mm</th>
            <th>Ancho mm</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody id="tabla-cristales-fijo">
        </tbody>
      </table>
    </div>

  </div>

  <!-- *********************************************************************************-->
  <!-- *****************          INFORME 2 de HOJA DE PEDIDO    ***********************-->
  <!-- *********************************************************************************-->
    <!-- ========================= HOJA DE PEDIDO ========================= -->

<div id="hoja-pedido-container" style="display:none; max-width:900px; margin:40px auto; padding:40px; background:white; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,.1);">

<div class="informe-header">
  <h1>PA VIDRIO MONTADO - HOJA DE PEDIDO</h1>
  <div class="info-basica">
    <div class="campo-informe"><label>Cliente</label><span id="hp-cliente" class="span-dato"></span></div>
    <div class="campo-informe"><label>N¬∫ Pedido</label><span id="hp-num-pedido" class="span-dato"></span></div>
    <div class="campo-informe"><label>Fecha</label><span id="hp-fecha" class="span-dato"></span></div>
    <div class="campo-informe"><label>Comentarios</label><span id="hp-Comentarios" class="span-dato"></span></div>
  </div>
</div>

<p id="hp-Titulo" style="font-weight:bold; margin:15px 0 0 0; font-size:14px;"></p>

<!-- MEDIDAS PUERTA -->
<div id="hp-bloque-puerta" class="bloque-informe">
  <div class="bloque-titulo">MEDIDAS PUERTA</div>
  <table class="tabla-informe">
    <thead>
        <tr>
            <th>C√≥digo</th> 
            <th>Concepto</th>
            <th>Valor</th>
            <th>Cantidad</th>
            <th>Precio ‚Ç¨</th>
        </tr>
    </thead>
    <tbody>
        <tr>
          <td id="hp-cod-puerta" class="texto-izq"></td>
          <td class="texto-izq">Tipo</td>
          <td id="hp-tipo-puerta"class="texto-izq"></td>
          <td id="hp-cant-puerta" class="texto-Der"></td>
          <td id="hp-precio-puerta" class="texto-Der"></td>
        </tr>
        <tr><td></td><td class="texto-izq">Acabado</td><td class="texto-izq" id="hp-acabado-puerta"></td></tr>
        <tr><td></td><td class="texto-izq">Color Vidrio</td><td class="texto-izq" id="hp-color-puerta"></td></tr>
        <tr><td></td><td class="texto-izq">Alto Puerta</td><td class="texto-Der" id="hp-alto-puerta"></td></tr>
        <tr><td></td><td class="texto-izq">Ancho Puerta</td><td class="texto-Der" id="hp-ancho-puerta"></td></tr>
        <tr id="fila-emb-puerta">   <!-- Para poder ocultar la linea   -->
            <td id="hp-cod-emb-puerta" class="texto-izq"></td>
            <td class="texto-izq">Embellecedor 13x3</td>
            <td id="hp-Embellecedor-puerta" class="texto-izq"></td>
            <td id="hp-cant-emb-puerta" class="texto-Der"></td>
            <td id="hp-precio-emb-puerta" class="texto-Der"></td>
        </tr> 
    </tbody>
  </table>
</div>

<!-- MEDIDAS FIJO -->
<div id="hp-bloque-fijo" class="bloque-informe">
  <div class="bloque-titulo">MEDIDAS FIJO</div>
  <table class="tabla-informe">
    <thead>
        <tr>
            <th>C√≥digo</th> 
            <th>Concepto</th>
            <th>Valor</th>
            <th>Cantidad</th>
            <th>Precio ‚Ç¨</th>
        </tr>
    </thead>    
    <tbody>
         <tr>
            <td id="hp-cod-fijo" class="texto-izq"></td>
            <td class="texto-izq">Fijo</td>
            <td id="hp-tipo-fijo" class="texto-izq"></td>
            <td id="hp-cant-fijo" class="texto-Der"></td>
            <td id="hp-precio-fijo" class="texto-Der"></td>
        </tr>
        <tr><td></td><td class="texto-izq">Acabado</td><td class="texto-izq" id="hp-acabado-fijo"></td></tr>
        <tr><td></td><td class="texto-izq">Color Vidrio</td><td class="texto-izq" id="hp-color-fijo"></td></tr>
        <tr><td></td><td class="texto-izq">Alto Fijo</td><td class="texto-Der" id="hp-alto-fijo"></td></tr>
        <tr><td></td><td class="texto-izq">Ancho Fijo</td><td class="texto-Der" id="hp-ancho-fijo"></td></tr>
        <tr id="fila-emb-fijo">  <!-- Para poder ocultar la linea   -->
            <td id="hp-cod-emb-fijo" class="texto-izq"></td>
            <td class="texto-izq">Embellecedor 13x3</td>
            <td id="hp-Embellecedor-fijo" class="texto-izq"></td>
            <td id="hp-cant-emb-fijo" class="texto-Der"></td>
            <td id="hp-precio-emb-fijo" class="texto-Der"></td>
        </tr>
        <tr>
            <td id="hp-cod-bastidor-fijo" class="texto-izq"></td>
            <td class="texto-izq">Bastidor</td>
            <td id="hp-bastidor-fijo" class="texto-izq"></td>
            <td id="hp-cant-bastidores" class="texto-Der"></td>
            <td id="hp-precio-bastidor-fijo" class="texto-Der"></td>
        </tr>
    </tbody>
  </table>
</div>

<div class="botones-informe">
  <button type="button" onclick="volverAlInicio()" class="btn">‚Üê Volver al Inicio</button>
  <button type="button" onclick="generarPDFCompleto(event)" class="btn">Descargar PDF</button>
</div>

</div>


  
  <!-- *********************************************************************************-->
  <!-- *****************-- CONTIN√öA EN PARTE 2 CON EL JAVASCRIPT ***********************-->
  <!-- *********************************************************************************-->
  <!-- *********************************************************************************-->


<script type="module">

  let tablasCargadas = false; // ‚òÖ A√±ade esto en la l√≠nea 1 de tu script

  import { cargarTablas, calcularPresupuesto } from './js/BuscaCodigoPrecio.js';



console.log('üîç VERIFICANDO M√ìDULO...');
console.log('¬øcalcularPresupuesto existe?', typeof calcularPresupuesto);
console.log('¬øcargarTablas existe?', typeof cargarTablas);

cargarTablas().then(() => {
  console.log('‚úÖ Tablas cargadas correctamente');
  
  // TEST con datos m√≠nimos
  const test = calcularPresupuesto({
    tipo: '01',
    color: 'L.BM03',
    vidrio: '01',
    altura: 2100,
    ancho: 850,
    modeloEmb: '',
    bastidor: ''
  });
  
  console.log('üîç TEST DIRECTO:', test);
  console.log('üîç ¬øTiene Puerta?', test?.Puerta);

}).catch(err => {
  console.error('‚ùå FALLO AL CARGAR TABLAS:', err);
  alert('ERROR CR√çTICO: No se cargaron las tablas de precios');
});



//   PRUEBA ++++++++++++++++++++++++++++++++++++++++++++++++







  // 1Ô∏è‚É£ DECLARAR PRIMERO las variables globales que se usan en todo el archivo
  let datosFormularios = {};  // ‚Üê USA let, NO const, y decl√°rala ANTES


//   MAPEOS PARA LA FUNCION
    const CODIGOS_ACABADO = {
        'Blanco mate 9003': 'L.BM03',
        'Negro mate texturado': 'L.NMT',
        'Acero corten': 'L.C',
        'Chapa roble barnizada': 'C.RB',
        'Chapa nogal barnizada': 'C.NG'
    };

    const CODIGOS_VIDRIO = {
        'TRANSPARENTE': '01',
        'MATE': '02',
        'BRONCE': '03',
        'GRIS': '04',
        'GRIS OSCURO': '05'
    };

    const CODIGOS_EMBELLECEDOR = {
        '0': '',
        '2': 'MA',
        '4': 'MB',
        '6': 'MC',
        'D': 'MD'
    };

    const CODIGOS_BASTIDOR = {
        '0': '0301',  // 3 paredes
        'A': '0302',  // 3 paredes U
        'B': '0401'   // 4 paredes
    };


    // Funci√≥n segura para establecer textContent
    function setSafeTextContent(id, valor) {
        const elemento = document.getElementById(id);
        if (elemento) {
            elemento.textContent = valor ?? ''; // Si valor es null/undefined, pone ''
        } else {
            console.warn(`‚ö†Ô∏è Elemento con id="${id}" no encontrado en el HTML`);
        }
    }

    // Funci√≥n segura para mostrar/ocultar elementos
    function setSafeDisplay(id, mostrar) {
        const elemento = document.getElementById(id);
        if (elemento) {
            elemento.style.display = mostrar ? 'block' : 'none';
        } else {
            console.warn(`‚ö†Ô∏è Elemento con id="${id}" no encontrado para ocultar/mostrar`);
        }
    }

 function guardarDatosFormulario(numForm) {
      

    // ==================== EXCEPCI√ìN FORM4 (texto del label) ====================
    if (numForm === 4) {
        const selected = document.querySelector('#form4 input[name="imagen"]:checked');
        if (!selected) return;

        const value = selected.value; // '0', 'A' o 'B'
        const labelText = selected.parentElement.querySelector('p').textContent.trim();
        const codigoBastidor = CODIGOS_BASTIDOR[value];
        
        datosFormularios.form4 = {
            imagen: selected.value,
            textoSeleccionado: labelText,
            codigoBastidor: codigoBastidor  // '0301', '0302' o '0401' ‚Üê C√ìDIGO LISTO
        };
        
        return; // Salir para no ejecutar c√≥digo general
    }


    // ==================== EXCEPCI√ìN FORM5 (radio buttons con estructura compleja) ====================
    if (numForm === 5) {
        const selected = document.querySelector('#form5 input[name="NumDiv"]:checked');
        if (!selected) return;

        const value = selected.value; // "0", "2", "4", "6", "D"
        const labelText = selected.parentElement.querySelector('p').textContent.trim();
        const codigoEmb = CODIGOS_EMBELLECEDOR[value];    // Transformar a c√≥digo de embellecedor
  
        datosFormularios.form5 = {
            division: {
                tipo: value,
                texto: labelText,
                codigoEmb: codigoEmb,  // '', 'MA', 'MB', 'MC' o 'MD' ‚Üê C√ìDIGO LISTO
                lineas: value === 'D' 
                    ? [
                        { medida: 'calc', cantidad: 2 },
                        { medida: 'calc', cantidad: 12 }
                    ]
                    : [{ medida: 'calc', cantidad: parseInt(value) }]
            }
        };
        
        return; // Salir para no ejecutar c√≥digo general
    }

        // ==================== EXCEPCI√ìN FORM6 (mapeo de acabado y vidrio) ====================
    if (numForm === 6) {
        const form = document.getElementById('form6');
        const formData = new FormData(form);
        
        // Extraer valores originales (texto)
        const acabadoTexto = formData.get('AcabadoAluminio');
        const vidrioTexto = formData.get('ColorVidrio');
        
        // Transformar a c√≥digos
        const codigoColor = CODIGOS_ACABADO[acabadoTexto];
        const codigoVidrio = CODIGOS_VIDRIO[vidrioTexto];
        
        // Guardar TODO: texto original + c√≥digos
        datosFormularios.form6 = {
            // Datos originales (textos para el informe)
            cliente: formData.get('cliente')?.trim(),
            numPedido: formData.get('numPedido')?.trim(),
            Alto: parseInt(formData.get('Alto')),
            Ancho: parseInt(formData.get('Ancho')),
            AcabadoAluminio: acabadoTexto,   // 'Blanco mate 9003'
            ColorVidrio: vidrioTexto,        // 'Transparente'
            conjuntos: parseInt(formData.get('conjuntos')) || 1,
            comentarios: formData.get('comentarios')?.trim(),
            
            // NUEVOS: C√≥digos para la funci√≥n de precios
            codigoColor: codigoColor,        // 'L.BM03'
            codigoVidrio: codigoVidrio       // '01'
        };
        
        return; // Salir para no ejecutar c√≥digo general
    }

    // ==================== C√ìDIGO GENERAL (Form1, Form2, Form3, Form6) ====================
    const form = document.getElementById(`form${numForm}`);
    const formData = new FormData(form);
    
    datosFormularios[`form${numForm}`] = {};
    for (let [key, value] of formData.entries()) {
        datosFormularios[`form${numForm}`][key] = value;
    }
}

   
function anteriorFormulario(actual) {
  // L√ìGICA ESPECIAL PARA FORM5
  if (actual === 5) {
    // Verificar si venimos de form3 (sin fijo) o de form4 (con fijo)
    const opcion = datosFormularios.form3?.opcion;
    if (opcion && !opcion.includes('fijo')) {
      // Si no tiene fijo, volver a form3
      document.getElementById(`form${actual}`).classList.remove('active');
      document.getElementById('form3').classList.add('active');
      return;
    }
  }
   // Limpiar datos del formulario actual -  a√±adido posterior para poder navergar y reflejar cambios
  datosFormularios[`form${actual}`] = {};

  // Navegaci√≥n normal
  document.getElementById(`form${actual}`).classList.remove('active');
  document.getElementById(`form${actual - 1}`).classList.add('active');
}

function siguienteFormulario(actual) {
  console.log(`üöÄ [FLUJO] Entrando en siguienteFormulario(${actual})`);
  
  try {
    // 1Ô∏è‚É£ VALIDAR 'actual'
    if (typeof actual !== 'number' || actual < 1 || actual > 6) {
      throw new Error(`'actual' inv√°lido: ${actual} (tipo: ${typeof actual})`);
    }
    
    // 2Ô∏è‚É£ OBTENER FORMULARIO ACTUAL
    const formIdActual = `form${actual}`;
    const formActual = document.getElementById(formIdActual);
    
    if (!formActual) {
      throw new Error(`Formulario '${formIdActual}' NO ENCONTRADO`);
    }
    
    console.log(`‚úÖ Formulario '${formIdActual}' encontrado`);

    // 3Ô∏è‚É£ VALIDAR FORMULARIO (dentro de try-catch)
    try {
      if (!validarFormulario(formActual, actual)) {
        console.warn(`‚ùå Form${actual} no validado`);
        return;
      }
    } catch (e) {
      throw new Error(`Error en validarFormulario(): ${e.message}`);
    }

    // 4Ô∏è‚É£ GUARDAR DATOS (dentro de try-catch)
    try {
      guardarDatosFormulario(actual);
      console.log(`üíæ Datos guardados para form${actual}:`, datosFormularios[`form${actual}`]);
    } catch (e) {
      throw new Error(`Error en guardarDatosFormulario(): ${e.message}`);
    }

    // 5Ô∏è‚É£ CASO ESPECIAL: Form6
    if (actual === 6) {
      console.log('üéØ Llegamos al form6, realizando c√°lculos...');
      
      const datosCalculados = realizarCalculos();
      
      if (!datosCalculados) {
        throw new Error('realizarCalculos() devolvi√≥ null');
      }
      
      console.log('‚úÖ C√°lculos completos, mostrando informes...');
      
      // ‚ö†Ô∏è CAPTURAR ERROR EN mostrarInformesCompletos
      try {
        mostrarInformesCompletos(datosCalculados);
      } catch (e) {
        throw new Error(`Error en mostrarInformesCompletos(): ${e.message}`);
      }
      return;
    }

    // 6Ô∏è‚É£ CASO ESPECIAL: Form3
    if (actual === 3) {
      const opcion = datosFormularios.form3?.opcion;
      const tieneFijo = opcion?.includes('fijo');
      
      console.log(`üö™ Form3: opci√≥n="${opcion}", tieneFijo=${tieneFijo}`);
      
      const form4 = document.getElementById('form4');
      const form5 = document.getElementById('form5');
      
      if (!form4 || !form5) {
        throw new Error('Form4 o Form5 no encontrados');
      }
      
      formActual.classList.remove('active');
      
      if (!tieneFijo) {
        console.log('‚è≠Ô∏è Saltando a form5');
        form5.classList.add('active');
      } else {
        console.log('‚û°Ô∏è Normal a form4');
        form4.classList.add('active');
      }
      return;
    }

    // 7Ô∏è‚É£ NAVEGACI√ìN NORMAL
    const siguienteNumero = actual + 1;
    const formIdSiguiente = `form${siguienteNumero}`;
    const formSiguiente = document.getElementById(formIdSiguiente);
    
    if (!formSiguiente) {
      throw new Error(`Formulario DESTINO '${formIdSiguiente}' NO ENCONTRADO`);
    }
    
    console.log(`‚û°Ô∏è Navegaci√≥n: ${formIdActual} ‚Üí ${formIdSiguiente}`);
    formActual.classList.remove('active');
    formSiguiente.classList.add('active');
    
  } catch (error) {
    // ‚≠ê ESTE CATCH CAPTURA EL ERROR EXACTO
    console.error('üí• ERROR CR√çTICO en siguienteFormulario():', error.message);
    console.error('üìç Stack trace:', error.stack);
    alert(`Error: ${error.message}\n\nRevisa la consola para m√°s detalles.`);
  }
}


function siguienteFormularioold(actual) {
  
  const form = document.getElementById(`form${actual}`);
  if (!validarFormulario(form, actual)) {
    return;
  }

  guardarDatosFormulario(actual);
 
  console.log(`üíæ Datos guardados para form${actual}:`, datosFormularios[`form${actual}`]);

  // L√ìGICA ESPECIAL PARA FORM3. Si NO tiene fijo, saltar al form5
  if (actual === 3) {
    const opcion = datosFormularios.form3.opcion;
    const tieneFijo = opcion.includes('fijo');
    
    if (!tieneFijo) {
        document.getElementById(`form${actual}`).classList.remove('active');
        document.getElementById('form5').classList.add('active');
    return;
    }
  }

  if (actual === 6) {

      const datosCalculados = realizarCalculos(); // ‚Üê RECIBE DATOS
      
    // VALIDACI√ìN DEFENSIVA
    if (!datosCalculados) {
      console.error('üí• Error: realizarCalculos() devolvi√≥ null');
      alert('Error en los c√°lculos. Revisa la consola.');
    return;
      }
    } 
  // Navegaci√≥n normal
  document.getElementById(`form${actual}`).classList.remove('active');
  document.getElementById(`form${actual + 1}`).classList.add('active');

}

function validarFormulario(form, numForm) {
  //  Valida si los formularios estan completos

  const tieneRadios = form.querySelector('input[type="radio"]');
  if (tieneRadios) {
    const radioSeleccionado = form.querySelector('input[type="radio"]:checked');
    if (!radioSeleccionado) {
      alert('Por favor, selecciona una opci√≥n antes de continuar');
      return false;
    }
    return true;
  }
  if (numForm === 6) {
    const alto = form.querySelector('#Alto');
    const ancho = form.querySelector('#Ancho');
    if (!alto.value || !ancho.value) {
      alert('Por favor, completa ambas medidas (Alto y Ancho)');
      return false;
    }

  if (alto.value <= 0 || alto.value > 2700 || ancho.value <= 0 || ancho.value > 4500) {
      alert('Revisar las medidas');
      return false;
    }
    return true;
  }
  const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
  for (let input of inputs) {
    if (!input.value) {
      alert('Por favor, completa todos los campos obligatorios');
      return false;
    }
  }
  return true;
}


// FUNCIONES AUXILIARES (deben estar ANTES de realizarCalculos)
function AnchoEleCorredera(opcion, ancho) {

 let X = 0; // Ancho del elemento
 let retracInf = 0
 let NumPuertas = 0
 let NumFijos = 0
    // Calcular X seg√∫n la opci√≥n seleccionada
  switch(opcion) {
    case '1puerta':
      X = ancho + 40;
      NumPuertas = 1
      break;
    case '1puerta-casoneto':
      X = ancho + 20;
      retracInf = 1
      NumPuertas = 1
      break;

    case '2puertas':
      X = (ancho / 2) + 6;
      NumPuertas = 2
      break;
    case '1puerta-1fijo':
      X = (ancho / 2) + 6;
      NumPuertas = 1
      NumFijos = 1
      break;

    case '3puertas':
      X = (ancho / 3) + 8;
      NumPuertas = 3
      break;
    case '2puertas-1fijo':
      X = (ancho / 3) + 8;
      NumPuertas = 2
      NumFijos = 1
      break;
    case '1puerta-2fijos':
      X = (ancho / 3) + 8;
      NumPuertas = 1
      NumFijos = 2
      break;

    case '2puertas-2fijos':
      X = (ancho / 4) + 6;
      NumPuertas = 2
      NumFijos = 2     
      break;
    case '3puertas-1fijo':
      X = (ancho / 4) + 9;
      NumPuertas = 3
      NumFijos = 1 
      break;
    case '4puertas':
      X = (ancho / 4) + 9;
      NumPuertas = 4
      break;
    default:
      X = 0; // Valor por defecto
  }
  console.log("ancho calculado",X)
  console.log(retracInf)
  return { X, retracInf, NumPuertas, NumFijos };    //  es el valor devuelto de la funci√≥n, para poder seguir usandola.

}


function AltoEleCorredera(guia,alto) {
let Y = 0; // alto del elemento
  switch(guia) {
    case 'SK112':
      Y = alto-15;
      break;
    case 'SK111':
      Y = alto-40-15;
      break;
    case 'SK119':
      Y = alto-15;
      break;
  }
  return { Y };    //  es el valor devuelto de la funci√≥n, para poder seguir usandola.
}


function realizarCalculos() {

  try {
    // Verificaci√≥n de seguridad
    if (!tablasCargadas) {
      throw new Error('Las tablas de precios no est√°n cargadas. Espera unos segundos y vuelve a intentar.');
    }
    
    if (typeof calcularPresupuesto !== 'function') {
      throw new Error('La funci√≥n calcularPresupuesto no est√° disponible.');
    }


  //try {
  console.log('=== INICIANDO C√ÅLCULOS ===');
  console.log('Datos recopilados:', datosFormularios);


  const guia = datosFormularios.form2?.guia || 'SK112';
  const opcion = datosFormularios.form3.opcion;
  const tipoFijo = datosFormularios.form4?.imagen || null;
  const textoTipoFijo = datosFormularios.form4?.textoSeleccionado || 'Sin tipo';
  const textoDivision = datosFormularios.form5?.division?.texto || 'Sin Datos';
  const cliente   = datosFormularios.form6.cliente?.trim();
  const numPedido = datosFormularios.form6.numPedido?.trim();
  const alto      = parseInt(datosFormularios.form6.Alto);
  const ancho     = parseInt(datosFormularios.form6.Ancho);
  const acabado   = datosFormularios.form6.AcabadoAluminio;
  const colorVidrio = datosFormularios.form6.ColorVidrio;
  const conjuntos = parseInt(datosFormularios.form6.conjuntos) || 1;
  const codigoColor = datosFormularios.form6?.codigoColor;
  const codigoVidrio = datosFormularios.form6?.codigoVidrio;
  const codigoEmb = datosFormularios.form5?.division?.codigoEmb || '';
  const codigoBastidor = datosFormularios.form4?.codigoBastidor || '';





  console.log('Valores extra√≠dos:', { opcion, tipoFijo, guia, alto, ancho, acabado, textoDivision, colorVidrio });

// PASO 1: Calcular valores b√°sicos
  const { X, retracInf, NumPuertas, NumFijos } = AnchoEleCorredera(opcion, ancho);
  const { Y } = AltoEleCorredera(guia, alto);

  const resultadoPuerta = calcularPerfilesPuerta(Y, X, NumPuertas, retracInf);
  const resultadoFijo = calcularPerfilesFijo(alto, X, NumFijos, tipoFijo);

  // Determinar qu√© bloques mostrar seg√∫n la opci√≥n
  const tienePuerta = opcion.includes('puerta');
  const tieneFijo = opcion.includes('fijo');

  console.log('Mostrar bloques:', { tienePuerta, tieneFijo });

// 4.1. Construir objetos de entrada  Para Codigo-Precio
    const entradaPuerta = {
        tipo: '01',
        color: codigoColor,
        vidrio: codigoVidrio,
        altura: Y,
        ancho: X,
        modeloEmb: codigoEmb,
        bastidor: ''
    };

    const entradaFijo = {
        tipo: '02',
        color: codigoColor,
        vidrio: codigoVidrio,
        altura: resultadoFijo.altoFijo,
        ancho: resultadoFijo.anchoFijo,
        modeloEmb: codigoEmb,
        bastidor: codigoBastidor
    };

    // 4.2. Llamar a calcularPresupuesto()
    const preciosPuerta = calcularPresupuesto(entradaPuerta);
    const preciosFijo = calcularPresupuesto(entradaFijo);

    console.log('üí∞ Precios Puerta:', preciosPuerta);
    console.log('üí∞ Precios Fijo:', preciosFijo);



    // 5. CONSTRUIR datosInforme COMPLETO

  const datosInforme = {

    cliente: cliente || 'Cliente',
    numPedido: numPedido || 'Sxx000',
    comentarios: datosFormularios.form6?.comentarios?.trim() || '  ',
    fecha: new Date().toLocaleDateString('es-ES'),
    mensajeOpcion: generarMensajeOpcion(opcion, tipoFijo, textoDivision, conjuntos),
    acabado: acabado,
    colorVidrio: colorVidrio,
    mostrarPuerta: tienePuerta || opcion === '1puerta' || opcion === '1puerta-casoneto' || opcion.includes('puertas'),
    mostrarFijo: tieneFijo,
    numPuertas: NumPuertas,
    numFijos: NumFijos,
    perfilesPuerta: resultadoPuerta.perfiles,
    perfilesFijo: resultadoFijo.perfiles,
    embellecedorPuerta: calcularEmbellecedorPuerta(X, Y, acabado), // PASAR EL VALOR
    embellecedorFijo: calcularEmbellecedorFijo(alto, X, acabado, tipoFijo),
    cristalesPuerta: resultadoPuerta.cristales,
    cristalesFijo: resultadoFijo.cristales,
    altoPuerta: Y,  // ‚Üê Guardados par el segundo informe
    anchoPuerta: X,
    altoFijo: resultadoFijo.altoFijo,
    anchoFijo: resultadoFijo.anchoFijo,
    textoDivision: textoDivision ,
    textoTipoFijo: textoTipoFijo,
    codigoColor: datosFormularios.form6?.codigoColor,
    codigoVidrio: datosFormularios.form6?.codigoVidri,
    // PRECIOS PUERTA (NUEVO)
        puertaCodigo: preciosPuerta.puerta.codigo,
        puertaPrecioUnit: preciosPuerta.puerta.precio,
        embPuertaCodigo: preciosPuerta.emb.codigo,
        embPuertaPrecioUnit: preciosPuerta.emb.precio,
    // PRECIOS FIJO (NUEVO)
        fijoCodigo: preciosFijo.puerta.codigo,
        fijoPrecioUnit: preciosFijo.puerta.precio,
        embFijoCodigo: preciosFijo.emb.codigo,
        embFijoPrecioUnit: preciosFijo.emb.precio,
        bastidorCodigo: preciosFijo.bast.codigo,
        bastidorPrecioUnit: preciosFijo.bast.precio,
  };



    // ‚≠ê‚≠ê‚≠ê CR√çTICO: DEVOLVER EL RESULTADO
    console.log('‚úÖ C√°lculos completos, devolviendo datos:', datosInforme);

    return datosInforme; // DEVUELVE los datos, se almacena en esa Variable
      } catch (error) {
    console.error('üí• ERROR FATAL en realizarCalculos():', error);
    alert('Error en c√°lculos: ' + error.message);
    return null; // ‚Üê Devuelve null en caso de error
  }

}

// Funciones para iconos de perfiles (im√°genes jpg desde GitHub)
function IconoVert(size = 40) {
  return `<img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/VERTICAL.jpg" width="${size}" height="${size}" crossorigin="anonymous" style="object-fit:contain;">`;
}

function IconoHoriz(size = 40) {
  return `<img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/HORIZONTAL.jpg" width="${size}" height="${size}" crossorigin="anonymous" style="object-fit:contain;">`;
}

function IconoBasePAFB(size = 40) {
  return `<img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/PAFB.jpg" width="${size}" height="${size}" crossorigin="anonymous" style="object-fit:contain;">`;
}

function IconoClipPAFC(size = 40) {
  return `<img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/PAFC.jpg" width="${size}" height="${size}" crossorigin="anonymous" style="object-fit:contain;">`;
}

function IconoPAFU(size = 40) {
  return `<img src="https://raw.githubusercontent.com/Jdurba/ImagenesPA/main/PAFU.jpg" width="${size}" height="${size}" crossorigin="anonymous" style="object-fit:contain;">`;
}



function generarMensajeOpcion(opcion, tipoFijo, textoDivision, conjuntos) {
    const comentarios = {
        '1puerta': '1 PUERTA',
        '1puerta-casoneto': '1 PUERTA CASONETO',
        '2puertas': '2 PUERTAS',
        '1puerta-1fijo': '1 PUERTA Y 1 FIJO',
        '3puertas': '3 PUERTAS',
        '2puertas-1fijo': '2 PUERTAS Y 1 FIJO',
        '1puerta-2fijos': '1 PUERTA Y 2 FIJOS',
        '2puertas-2fijos': '2 PUERTAS Y 2 FIJOS', 
        '3puertas-1fijo': '3 PUERTAS Y 1 FIJO',
        '4puertas': '4 PUERTAS'
    };
  
    const tiposFijo = {
        '0': ' - 3 PAREDES',
        'A': ' - 3 PAREDES con PAFU',
        'B': ' - 4 PAREDES'
    };
    
    let mensaje = comentarios[opcion] || 'CONFIGURACI√ìN PERSONALIZADA';
    
    // Si tiene fijo, a√±adir el tipo
    if (tipoFijo && tiposFijo[tipoFijo]) {
        mensaje += tiposFijo[tipoFijo];
    }
    
    // ‚ûú NUEVO: A√±adir texto de divisiones si existe, aunque siempre existe.
    mensaje += ` - ${textoDivision || 'Sin embellecedor PEPE'}`;

    // ‚ûú NUEVO: A√±adir el n√∫mero de conjuntos al final
    mensaje += ` - ( ${conjuntos} CONJUNTO${conjuntos > 1 ? 'S' : ''} )`;

    return mensaje;
}

//function formatearNumero(numero) {
//  return new Intl.NumberFormat('es-ES').format(numero);
//}



function formatearNumero(numero, decimales = 0) {
  // Convertir a n√∫mero si es string
  const num = typeof numero === 'string' ? parseFloat(numero) : numero;
  
  // Si no es un n√∫mero v√°lido, devolver el valor original o '-'
  if (isNaN(num) || num === null || num === undefined) {
    return numero ?? '-';
  }
  
  // Formatear con separador de miles y decimales configurables
  return new Intl.NumberFormat('es-ES', {
    minimumFractionDigits: decimales,
    maximumFractionDigits: decimales,
    useGrouping: true // separador de miles
  }).format(num);
}



// --------------    Funciones del bloque 1 , Puertas  -----------------------------------

function calcularPerfilesPuerta(Y, X, NumPuertas, retracInf) {

  //  Desdoblo en dos el resultado de la funcion Perfiles y cristales ya que los datos origen son los mismos
  return {  
    perfiles: [
      { icono: IconoVert(30), tipo: 'Verticales Retrac', longitud: Y, cantidad: NumPuertas * 2, retracInf: retracInf },
      { icono: IconoHoriz(25), tipo: 'Horizontales', longitud: X - 24, cantidad: NumPuertas * 2, retracInf: "" }
    ],
    cristales:[
      { descripcion: 'Vidrio 4 mm', alto: Y-58, ancho: X-10, cantidad: NumPuertas }
    ]
  };
}

function calcularEmbellecedorPuerta(X, Y, acabado) {
  const div = datosFormularios.form5?.division;
  if (!div) return [];

  return div.lineas.map((l, i) => {
    const longitud = div.tipo === 'D'
      ? (i === 0 ? Y - 70 : X - 37 )
      : X - 24;

    return {
      tipo: `Pletina 13x3mm ${acabado}${div.tipo === 'D' ? (i === 0 ? ' - Vertical' : ' - Horizontal') : ''}`,
      longitud,
      cantidad: l.cantidad
    };
  });
}



// -----------------------------------------------------------------------------------------------
// --------------    Funciones del bloque 2 , Fijos  -----------------------------------


function calcularPerfilesFijo(alto, X, NumFijos, tipoFijo) {
  // El fijo usa el alto original (form6), NO el Y de la puerta
  // Solo necesita X para calcular el ancho del cristal


  console.log('tipofijo recibido:', tipoFijo);
  

  let verticales = { longitud: 0, cantidad: 0 };
  let horizontales = { longitud: 0, cantidad: 0 };
  let perfilBase_Vertical = { longitud: 0, cantidad: 0 };
  let perfilBase_Horizontal = { longitud: 0, cantidad: 0 };
  let perfilClip_Vertical = { longitud: 0, cantidad: 0 };
  let perfilClip_Horizontal = { longitud: 0, cantidad: 0 };
  let perfilU_Vertical = { longitud: 0, cantidad: 0 };
  let perfilU_Horizontal = { longitud: 0, cantidad: 0 };
  let altoFijo = 0;  //  medida del elemento fijo alto
  let anchoFijo = 0; //  medida del elemento fijo ancho
  let embellecedorFijo = [];

  // ‚úÖ Control por si tipofijo es null
  if (!tipoFijo || NumFijos === 0) {
    return { perfiles: [], cristales: [], altoFijo: 0, anchoFijo: 0 };
  }
  // Calcular seg√∫n el tipo de fijo seleccionado
  switch(tipoFijo) {
    case '0': // 3 paredes
        verticales = { longitud: alto - 29, cantidad: 2 * NumFijos };  // -19-8-2 (holgura) = 29
        horizontales = { longitud: X - 42, cantidad: 2 * NumFijos };   // -8-12-12-8-2(holgura)= 42
        altoFijo =  alto - 29   // igual que el vertical
        anchoFijo = X - 18   // -8-8-2 
        perfilBase_Horizontal = {longitud: X - 36, cantidad: 1 * NumFijos}; // 
        perfilClip_Horizontal = {longitud: X - 36, cantidad: 1 * NumFijos};
        perfilU_Vertical = {longitud: alto, cantidad: 2 * NumFijos};
        perfilU_Horizontal = {longitud: X - 36, cantidad: 1 * NumFijos};
        break;
      
    case 'A': // 3 paredes con PAFU
        verticales = { longitud: alto - 18, cantidad: 2 * NumFijos };   // -8-8-2 (holgura) = 18
        horizontales = { longitud: X - 42, cantidad: 2 * NumFijos };    //   -8-12-12-8-2(holgura)= 42
        altoFijo =  alto - 18   // igual que el vertical
        anchoFijo = X - 18   // -8-8-2       
        perfilU_Vertical = {longitud: alto, cantidad: 2 * NumFijos};
        perfilU_Horizontal = {longitud: X - 36, cantidad: 2 * NumFijos};
        break;
      
    case 'B': // 4 paredes
        verticales = { longitud: alto - 29, cantidad: 2 * NumFijos };     // -19-8-2 (holgura) = 29
        horizontales = { longitud: X - 83, cantidad: 2 * NumFijos };      // -19-12-12-19-2(holgura)= 64
        altoFijo =  alto - 29   // igual que el vertical
        anchoFijo = X - 40   // -19-19-2 
        perfilBase_Vertical = {longitud: alto, cantidad: 2 * NumFijos}; 
        perfilClip_Vertical = {longitud: alto, cantidad: 2 * NumFijos}; 
        perfilBase_Horizontal = {longitud: X - 62, cantidad: 1 * NumFijos};
        perfilClip_Horizontal = {longitud: X - 62, cantidad: 1 * NumFijos};
        perfilU_Horizontal = {longitud: X - 62, cantidad: 1 * NumFijos};
        break;
    }
  
 
    // Crear array de perfiles solo con los que tienen cantidad > 0
    const perfiles = [
    
    // Verticales y horizontales SIEMPRE visibles
        { 
        icono: IconoVert(30), 
        tipo: 'Verticales', 
        longitud: verticales.longitud, 
        cantidad: verticales.cantidad 
        },
        { 
        icono: IconoHoriz(25), 
        tipo: 'Horizontales', 
        longitud: horizontales.longitud, 
        cantidad: horizontales.cantidad 
        }
    ];
    
    if (perfilBase_Vertical.cantidad > 0) {
    perfiles.push({ 
        icono: IconoBasePAFB(25), 
        tipo: 'Perfil Base Fijo Vertical', 
        longitud: perfilBase_Vertical.longitud, 
        cantidad: perfilBase_Vertical.cantidad 
    });
    }
    // Agregar Perfil Clip Vertical solo si existe
    if (perfilClip_Vertical.cantidad > 0) {
        perfiles.push({ 
        icono: IconoClipPAFC(25), 
        tipo: 'Perfil Clip Fijo Vertical', 
        longitud: perfilClip_Vertical.longitud, 
        cantidad: perfilClip_Vertical.cantidad 
        });
    }

    if (perfilBase_Horizontal.cantidad > 0) {
    perfiles.push({ 
        icono: IconoBasePAFB(25), 
        tipo: 'Perfil Base Fijo Horizontal', 
        longitud: perfilBase_Horizontal.longitud, 
        cantidad: perfilBase_Horizontal.cantidad 
    });
    }

    // Agregar Perfil Clip Horizontal solo si existe
    if (perfilClip_Horizontal.cantidad > 0) {
        perfiles.push({ 
        icono: IconoClipPAFC(25), 
        tipo: 'Perfil Clip Fijo Horizontal', 
        longitud: perfilClip_Horizontal.longitud, 
        cantidad: perfilClip_Horizontal.cantidad 
        });
    }

    // Agregar Perfil U Vertical solo si existe
    if (perfilU_Vertical.cantidad > 0) {
        perfiles.push({ 
        icono: IconoPAFU(30), 
        tipo: 'Perfil U Fijo Vertical', 
        longitud: perfilU_Vertical.longitud, 
        cantidad: perfilU_Vertical.cantidad 
        });
    }
    
    // Agregar Perfil U Horizontal solo si existe
    if (perfilU_Horizontal.cantidad > 0) {
        perfiles.push({ 
        icono: IconoPAFU(30), 
        tipo: 'Perfil U Fijo Horizontal', 
        longitud: perfilU_Horizontal.longitud, 
        cantidad: perfilU_Horizontal.cantidad 
        });
    }
    
    // Calcular medidas del cristal del fijo  usando los valores ya calculados
    const altoCristalFijo = verticales.longitud - 58;  // alto form6 - perfilesfijo - holguras = Verticales.longitud y luego -58 
    const anchoCristalFijo = horizontales.longitud - 10;    // Depende igualmente de los perfiles fijos elegidos

    return {
        perfiles: perfiles,
        cristales: [
        { descripcion: 'Vidrio 4 mm', alto: altoCristalFijo, ancho: anchoCristalFijo, cantidad: NumFijos }
        ],
        altoFijo,   // ‚ûú nuevo
        anchoFijo
    };
}


function calcularEmbellecedorFijo(alto, X, acabado, tipoFijo) {
  const div = datosFormularios.form5?.division;
  if (!div) return [];

  /* tabla de f√≥rmulas con alto bruto */
  const f = {
    '0': { v: alto - 29 - 70, h: X - 42 - 13 },
    'A': { v: alto - 18 - 70, h: (X - 42 - 13) / 2 },
    'B': { v: alto - 29 - 70, h: (X - 83 - 13) / 2 }
  }[tipoFijo] || { v: 0, h: 0 };

  return div.lineas.map((l, i) => ({
    tipo: `Pletina 13x3mm ${acabado}${div.tipo === 'D' ? (i === 0 ? ' - Vertical' : ' - Horizontal') : ''}`,
    longitud: div.tipo === 'D' ? (i === 0 ? f.v : f.h) : X - 24,
    cantidad: l.cantidad
  }));
}

// -----------------------  fin de Funciones bloque 2 y del informe    -------------------------------------

function mostrarInformesCompletos(d) { // ‚Üê 'd' es el PAR√ÅMETRO
  console.log('üìä Mostrando informes con datos Joaquin:', d);
  
  if (!d) {
    console.error('üí• No hay datos para mostrar');
    alert('Error: No se recibieron datos del c√°lculo');
    return;
  }

  // Ocultar formularios
  document.querySelectorAll('.formulario').forEach(form => {
    form.classList.remove('active');
  });

  // ===== INFORME 1: DATOS B√ÅSICOS =====
  setSafeTextContent('inf-cliente', d.cliente);
  setSafeTextContent('inf-num-pedido', d.numPedido);
  setSafeTextContent('inf-fecha', d.fecha);
  setSafeTextContent('inf-comentarios', d.comentarios);
  setSafeTextContent('mensaje-opcion', d.mensajeOpcion);

  // ===== INFORME 1: BLOQUE PUERTA =====
  setSafeDisplay('bloque-puerta', d.mostrarPuerta);
  if (d.mostrarPuerta) {
    llenarBloquePuerta(d);
  }

  // ===== INFORME 1: BLOQUE FIJO =====
  setSafeDisplay('bloque-fijo', d.mostrarFijo);
  if (d.mostrarFijo) {
    llenarBloqueFijo(d);
  }

  // ===== INFORME 2: DATOS B√ÅSICOS =====
  setSafeTextContent('hp-cliente', d.cliente);
  setSafeTextContent('hp-num-pedido', d.numPedido);
  setSafeTextContent('hp-fecha', d.fecha);
  setSafeTextContent('hp-Comentarios', d.comentarios);
  setSafeTextContent('hp-Titulo', d.mensajeOpcion);

  // ===== INFORME 2: BLOQUE PUERTA =====
  setSafeDisplay('hp-bloque-puerta', d.mostrarPuerta);
  if (d.mostrarPuerta) {
    setSafeTextContent('hp-tipo-puerta', 'CORREDERA');
    setSafeTextContent('hp-cant-puerta', d.numPuertas);
    setSafeTextContent('hp-acabado-puerta', d.acabado);
    setSafeTextContent('hp-color-puerta', d.colorVidrio);
    setSafeTextContent('hp-alto-puerta', formatearNumero(d.altoPuerta) + ' mm');
    setSafeTextContent('hp-ancho-puerta', formatearNumero(d.anchoPuerta) + ' mm');
    setSafeTextContent('hp-Embellecedor-puerta', d.textoDivision);
    setSafeTextContent('hp-cant-emb-puerta', d.numPuertas);
        // ===== NUEVO: PRECIOS PUERTA =====
    setSafeTextContent('hp-cod-puerta', d.puertaCodigo);
    setSafeTextContent('hp-precio-puerta', formatearNumero(d.puertaPrecioUnit, 2));
    setSafeTextContent('hp-cod-emb-puerta', d.embPuertaCodigo);
    setSafeTextContent('hp-precio-emb-puerta', formatearNumero(d.embPuertaPrecioUnit, 2));
  }

  // ===== INFORME 2: BLOQUE FIJO =====
  setSafeDisplay('hp-bloque-fijo', d.mostrarFijo);
  if (d.mostrarFijo) {
    setSafeTextContent('hp-tipo-fijo', 'FIJO');
    setSafeTextContent('hp-cant-fijo', d.numFijos);
    setSafeTextContent('hp-acabado-fijo', d.acabado);
    setSafeTextContent('hp-color-fijo', d.colorVidrio);
    setSafeTextContent('hp-alto-fijo', formatearNumero(d.altoFijo) + ' mm');
    setSafeTextContent('hp-ancho-fijo', formatearNumero(d.anchoFijo) + ' mm');
    setSafeTextContent('hp-Embellecedor-fijo', d.textoDivision);
    setSafeTextContent('hp-cant-emb-fijo', d.numFijos);
    setSafeTextContent('hp-bastidor-fijo', d.textoTipoFijo);
    setSafeTextContent('hp-cant-bastidores', d.numFijos);
        // ===== NUEVO: PRECIOS FIJO =====
    setSafeTextContent('hp-cod-fijo', d.fijoCodigo);
    setSafeTextContent('hp-precio-fijo', formatearNumero(d.fijoPrecioUnit, 2));
    setSafeTextContent('hp-cod-emb-fijo', d.embFijoCodigo);
    setSafeTextContent('hp-precio-emb-fijo', formatearNumero(d.embFijoPrecioUnit, 2));
    setSafeTextContent('hp-cod-bastidor-fijo', d.bastidorCodigo);
    setSafeTextContent('hp-precio-bastidor-fijo', formatearNumero(d.bastidorPrecioUnit, 2));
  }

  // ===== MOSTRAR CONTENEDORES =====
  setSafeDisplay('informe-container', true);
  setSafeDisplay('hoja-pedido-container', true);
  
  // SCROLL
  const informeContainer = document.getElementById('informe-container');
  if (informeContainer) {
    informeContainer.scrollIntoView({ behavior: 'smooth' });
  }
}


function volverAlInicio() {
  // Ocultar informes
  document.getElementById('informe-container').style.display = 'none';
  document.getElementById('hoja-pedido-container').style.display = 'none';

   // Limpiar datos de los formularios
  for (let i = 2; i <= 6; i++) {
    datosFormularios[`form${i}`] = {};
  }
  
  // Limpiar √∫ltimos datos de informe
  window.ultimosDatosInforme = null;


  // Ocultar bloques
  document.getElementById('bloque-puerta').classList.remove('active');
  document.getElementById('bloque-fijo').classList.remove('active');
  document.getElementById('hp-bloque-puerta').classList.remove('active');
  document.getElementById('hp-bloque-fijo').classList.remove('active');
  
  // Volver al form1
  document.getElementById('form1').classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}


function llenarBloquePuerta(datos) {
  // Perfiles (c√≥digo existente)
  document.getElementById('acabado-puerta').textContent = datos.acabado;
  document.getElementById('color-vidrio-puerta').textContent = datos.colorVidrio;

  const tablaPerfiles = document.getElementById('tabla-perfiles-puerta');
  tablaPerfiles.innerHTML = '';
  datos.perfilesPuerta.forEach(perfil => {
    tablaPerfiles.innerHTML += `
      <tr>
        <td class="imagen-perfil">${perfil.icono || ''}</td>
        <td class="texto-izq">${perfil.tipo}</td>
        <td>${formatearNumero(perfil.longitud)}</td>
        <td>${formatearNumero(perfil.cantidad)}</td>
        <td>${formatearNumero(perfil.retracInf)}</td>
      </tr>
    `;
  });

  // ===== SECCI√ìN EMBELLECEDOR (TRABAJA DIRECTO CON LA TABLA) =====
  const tablaEmbellecedor = document.getElementById('tabla-embellecedor-puerta');
  
  if (!tablaEmbellecedor) {
    console.warn('‚ö†Ô∏è tabla-embellecedor-puerta no encontrada');
    return;
  }

  const hayEmbellecedores = datos.embellecedorPuerta?.some(item => item.cantidad > 0);

  if (hayEmbellecedores) {
    // Mostrar tabla y llenar datos
    const tabla = tablaEmbellecedor.closest('table');
    if (tabla) tabla.style.display = 'table';
    
    tablaEmbellecedor.innerHTML = '';
    datos.embellecedorPuerta.forEach(item => {
      if (item.cantidad > 0) {
        tablaEmbellecedor.innerHTML += `
          <tr>
            <td class="texto-izq">${item.tipo}</td>
            <td>${formatearNumero(item.longitud)}</td>
            <td>${formatearNumero(item.cantidad)}</td>
          </tr>
        `;
      }
    });
  } else {
    // Ocultar tabla completa si no hay embellecedores
    const tabla = tablaEmbellecedor.closest('table');
    if (tabla) tabla.style.display = 'none';
    tablaEmbellecedor.innerHTML = ''; // Limpiar contenido
  }

  // Cristales (c√≥digo existente)
  const tablaCristales = document.getElementById('tabla-cristales-puerta');
  tablaCristales.innerHTML = '';
  datos.cristalesPuerta.forEach(cristal => {
    tablaCristales.innerHTML += `
      <tr>
        <td class="texto-izq">${cristal.descripcion}</td>
        <td>${formatearNumero(cristal.alto)}</td>
        <td>${formatearNumero(cristal.ancho)}</td>
        <td>${formatearNumero(cristal.cantidad)}</td>
      </tr>
    `;
  });
}


function llenarBloqueFijo(datos) {
  // Perfiles y cristales (c√≥digo existente)
  document.getElementById('acabado-fijo').textContent = datos.acabado;
  document.getElementById('color-vidrio-fijo').textContent = datos.colorVidrio;

  const tablaPerfiles = document.getElementById('tabla-perfiles-fijo');
  tablaPerfiles.innerHTML = '';
  datos.perfilesFijo.forEach(perfil => {
    tablaPerfiles.innerHTML += `
      <tr>
        <td class="imagen-perfil">${perfil.icono || ''}</td>
        <td class="texto-izq">${perfil.tipo}</td>
        <td>${formatearNumero(perfil.longitud)}</td>
        <td>${formatearNumero(perfil.cantidad)}</td>
      </tr>
    `;
  });

  // ===== SECCI√ìN EMBELLECEDOR FIJO =====
  const tablaEmbFijo = document.getElementById('tabla-embellecedor-fijo');
  
  if (!tablaEmbFijo) {
    console.warn('‚ö†Ô∏è tabla-embellecedor-fijo no encontrada');
    return;
  }

  const hayEmbellecedores = datos.embellecedorFijo?.some(item => item.cantidad > 0);

  if (hayEmbellecedores) {
    const tabla = tablaEmbFijo.closest('table');
    if (tabla) tabla.style.display = 'table';
    
    tablaEmbFijo.innerHTML = '';
    datos.embellecedorFijo.forEach(item => {
      if (item.cantidad > 0) {
        tablaEmbFijo.innerHTML += `
          <tr>
            <td class="texto-izq">${item.tipo}</td>
            <td>${formatearNumero(item.longitud)}</td>
            <td>${formatearNumero(item.cantidad)}</td>
          </tr>
        `;
      }
    });
  } else {
    const tabla = tablaEmbFijo.closest('table');
    if (tabla) tabla.style.display = 'none';
    tablaEmbFijo.innerHTML = '';
  }

  // Cristales fijos
  const tablaCristales = document.getElementById('tabla-cristales-fijo');
  tablaCristales.innerHTML = '';
  datos.cristalesFijo.forEach(cristal => {
    tablaCristales.innerHTML += `
      <tr>
        <td class="texto-izq">${cristal.descripcion}</td>
        <td>${formatearNumero(cristal.alto)}</td>
        <td>${formatearNumero(cristal.ancho)}</td>
        <td>${formatearNumero(cristal.cantidad)}</td>
      </tr>
    `;
  });
}



function cerrarInforme() {
  document.getElementById('informe-container').style.display = 'none';
  document.getElementById('form1').classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function volverInforme1() {
  document.getElementById('hoja-pedido-container').style.display = 'none';
  document.getElementById('informe-container').style.display = 'block';
  document.getElementById('informe-container').scrollIntoView({ behavior: 'smooth' });
}

function cerrarHojaPedido() {
  document.getElementById('hoja-pedido-container').style.display = 'none';
  document.getElementById('form1').classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}


// Funci√≥n para iniciar la app SOLO cuando las tablas est√©n listas
async function iniciarAplicacion() {
  try {
    console.log('üöÄ Cargando tablas de precios...');
    await cargarTablas();
    tablasCargadas = true; // ‚òÖ Marcar como cargadas
    console.log('‚úÖ Tablas cargadas. Aplicaci√≥n lista.');
  } catch (error) {
    console.error('‚ùå FALLO CR√çTICO al cargar tablas:', error);
    alert('ERROR: No se pueden cargar los precios. La aplicaci√≥n no funcionar√°.');
  }
}


// Exponer funciones al global
window.siguienteFormulario = function(actual) {
  if (!tablasCargadas) {
    alert('‚è≥ Espera, las tablas de precios a√∫n no se han cargado. Intenta de nuevo en unos segundos.');
    return;
  }
  // Llamar a la funci√≥n real
  return siguienteFormulario(actual);
};



  // 2. AL FINAL, exponer funciones al global:
  window.siguienteFormulario = siguienteFormulario;
  window.anteriorFormulario = anteriorFormulario;
  window.volverAlInicio = volverAlInicio;
  window.cerrarInforme = cerrarInforme; 
  // ... todas las funciones que usas en onclick=
  
  // Iniciar al cargar la p√°gina
  iniciarAplicacion();

</script>

 </body>



 </html>